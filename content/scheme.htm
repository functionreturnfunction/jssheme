<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html> <head>
<title>Scheme Interpreter</title>
<style type=text/css>
#txtInput {
  width: 100%
}
.bold {
  font-weight: bold
}
</style>
</head>

<body>
<h1>Scheme Interpreter</h1>
<textarea id=txtInput></textarea><br>
<input type=button id=btnGo value="Go!" onclick="interpret()">
<input type=button id=btnTest value="Display Test Results" onclick="displayResults()">
<input type=button id=btnBenchmark value="Run Benchmark" onclick="benchmark()"><br/><br/>
<pre id=result></pre>

<hr>
<address></address>
<!-- hhmts start --> Last modified: Wed Mar 12 07:40:32 EDT 2008 <!-- hhmts end -->
<script type=text/javascript language=javascript src="../src/scheme.js"></script>
<script type=text/javascript language=javascript src="../lib/qunitRhino.js"></script>
<script type=text/javascript language=javascript>
//var CODE = '(define fib (lambda (i) (if (< i 2) i (+ (fib (- i 1)) (fib (- i 2))))))';
var CODE = '(define fib (lambda (i) (begin (pp (string-append "running with i = " (number->string i))) (if (< i 2) i (let ((first (fib (- i 1))) (second (fib (- i 2)))) (begin (pp (string-append "adding " (number->string first) " to " (number->string second))) (+ first second)))))))';

function $(id) { return document.getElementById(id); }

$('txtInput').value = CODE;

function interpret() {
  var output = $('result'), result;
  output.innerHTML = '';
  try {
    result = Interpreter.parse($('txtInput').value);
    if( result == undefined ) {
      result = ';Unspecified return value'
    } else {
      result = ';Value: ' + result.toString();
    }
  } catch(e) {
    if( !Interpreter.exception )
      throw(e);
    result = '<span class=bold>Exception:</span><br/>;' + e.toString();
  }
  output.innerHTML += result;
}

function displayResults() {
  var result = $('result');
  result.innerHTML = '';
  new QUnit.HtmlPrinter(result).print();
}

function benchmark() {
  var times = parseInt(prompt('How many times?', '100')) - 1;
  var code = $('txtInput').value;
  var result;
  var date = new Date();
  for( var i = 0; i < times; i++ ) {
    Interpreter.parse(code);
  }
  result = Interpreter.parse(code);
  date = new Date() - date;
  $('result').innerHTML = ';Value: ' + result.toString() + '<br>Took ' +
    date.toString() + 'ms to run ' + (++times).toString() + ' times.'
}

Interpreter.initPrinter(function (str) {
  $('result').innerHTML += str;
});
</script>
<!-- needs to load after the printer is initialized -->
<script type=text/javascript language=javascript src="../test/schemeTest.js"></script>
</body> </html>
